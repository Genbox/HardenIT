@using HardenIT.Code.Models.Enums
@using HardenIT.Code.ViewModels
@model HardenIT.Code.ViewModels.MenuItemsAndLevel

@{
    int[] levels = (int[])Enum.GetValues(typeof(SecurityLevel));
    string[] names = Enum.GetNames(typeof(SecurityLevel));

    string level = string.Join(",", levels.Skip(1));
    string name = string.Empty;

    foreach (string n in names.Skip(1))
    {
        name += "\"" + n + "\",";
    }

    name = name.TrimEnd(',');
}

<div class="row" style="margin-top: 20px;">
    <div class="col-lg-12">
        <div class="col-md-4 text-center">
            <h4>1. Set Security Level</h4>
            <form id="form1" action="@Url.Action("Index", "Firefox")" method="POST">
                <input id="sliderValue"
                       type="text"
                       name="sliderValue"
                       data-provide="slider"
                       data-slider-ticks="[@level]"
                       data-slider-ticks-labels='[@Html.Raw(name)]'
                       data-slider-min="1"
                       data-slider-max="3"
                       data-slider-step="1"
                       data-slider-value="@((int)Model.Level)"
                       data-slider-tooltip="hide">
            </form>
        </div>
        <div class="col-md-4 text-center">
            <h4>2. Customize!</h4>
            Select the options you would like to enable or disable.
        </div>
        <div class="col-md-4 text-center">
            <h4>3. Generate Config</h4>
            <button id="generateConfig" class="btn btn-success"><span class="glyphicon glyphicon-download-alt"></span> Download</button>
        </div>
        <div class="clearfix"></div>
        <hr />
        <ul class="nav nav-pills">
            @for (int i = 0; i < Model.MenuItems.Count; i++)
            {
                <li @(i == 0 ? "class=active" : "")><a href="#@i-item" data-toggle="tab">@Model.MenuItems[i].Name</a></li>
            }
        </ul>
        <div id="seaOfControls" class="tab-content">
            @for (int i = 0; i < Model.MenuItems.Count; i++)
            {
                <div class="tab-pane @(i == 0 ? "active" : "")" id="@i-item">
                    @{ Html.RenderPartial("_Data", new MenuItemAndLevel { Level = Model.Level, MenuItem = Model.MenuItems[i] }); }
                </div>
            }
        </div>
    </div>
</div>

@section Scripts
{
    <script language="javascript">

        $('#sliderValue').on('slideStop', function () {
            document.getElementById("form1").submit();
        });

        $('#generateConfig').click(function () {
            var matches = [];

            var controls = $("#seaOfControls :input");
            for (var i = 0; i < controls.length; i++) {
                if (controls[i].name.indexOf('FSC-') === 0) {
                    matches.push(controls[i]);
                }
            }

            var data = "";

            for (var x = 0; x < matches.length; x++) {
                var name = matches[x].name.substring(4);
                var value = matches[x].value;

                if (matches[x].type === "checkbox") {
                    if (matches[x].checked)
                        value = true;
                    else
                        value = false;
                }

                if (matches[x].type === "text")
                    value = "\"" + value + "\"";

                data += "user_perf(\"" + name + "\", " + value + ");\r\n";

            }

            download(data, "user.js", "application/javascript");
        });

    </script>
}